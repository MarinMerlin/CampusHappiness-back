{"version":3,"sources":["../../routes/admin.js"],"names":["express","require","passport","router","Router","bodyParser","use","json","urlencoded","extended","morgan","Models","Data","adminLoginStrategy","serializeUser","user","done","console","log","id","deserializeUser","req","res","next","isAuthenticated","url","status","message","post","authenticate","session","send","dataValues","pseudo","login","err","JSON","stringify","serverResponse","success","admin","get","destroy","Admin","findOne","where","then","body","mp","addAdmin","Date","now","promises","userList","forEach","push","User","addUser","firstName","lastName","email","Promise","all","getSondage","sondageList","createSondage","name","Sondage","update","current","sondage","getNumberRemplissages","count","getNumberRemplissagesJour","params","jour","getCommentairesJour","comments","getNumberReponses","getNumberReponsesJour","findById","getStatistics","statisticTab","getStatisticsSpecific","sondageResult","module","exports"],"mappings":"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","sourcesContent":["const express = require('express');\nconst passport = require('passport');\n\nconst router = express.Router();\n\n\n// Le body Parser permet d'acceder aux variable envoyés dans le body\nconst bodyParser = require('body-parser');\n\nrouter.use(bodyParser.json());\nrouter.use(express.urlencoded({ extended: false }));\n\nconst morgan = require('morgan');\n\n// Récupère les models\nconst Models = require('../models/index');\n\n// Récupère les fonctions de recherche de données\nconst Data = require('../models/dataFetch');\n\nrouter.use(morgan('dev'));\n\n// Authentification\nconst adminLoginStrategy = require('../passport-config/adminStrategy');\n\npassport.use(adminLoginStrategy);\npassport.serializeUser((user, done) => {\n  console.log('Inside serializeUser callback. User id is save to the session file store here');\n  done(null, user.id);\n});\npassport.deserializeUser(function (id, done) {\n  done(null, id);\n});\n\nrouter.use((req, res, next) => {\n  if (!req.isAuthenticated() && req.url !== '/login') {\n    res.status(401).json({ message: 'Unauthorized. User not logged in!' });\n  } else {\n    next();\n  }\n});\n\nrouter.post('/login',\n  passport.authenticate('local', { session: true }),\n  (req, res) => {\n    switch (req.user) {\n      case \"wrongUser\":\n        res.status(460).send(\"Wrong username\");\n        break;\n      case \"wrongPass\":\n        res.status(461).send(\"Wrong username\");\n        break;\n      default:\n        console.log(\"Correct authentification: \", req.user.dataValues.pseudo);\n        req.login(req.user, (err) => {\n          console.log('Inside req.login() callback');\n          console.log(`req.session.passport: ${JSON.stringify(req.session.passport)}`);\n          console.log(`req.user: ${JSON.stringify(req.user)}`);\n        });\n        const serverResponse = { \n          success: true, \n          admin: { pseudo: req.user.dataValues.pseudo },\n        };\n        res.json(serverResponse);\n    }\n  });\n\n// --------- Routes protegées par token -------------\n\n// Un administrateur peut ajouter un autre administrateur :\n// Les attributs de l'admin sont dans le body de la requète\n// TODO : Prendre en compte le cas où il y a une erreure au cours de la création de l'admin'\n\n// Logout the session\n\nrouter.get('/logout', (req, res) => {\n  req.session.destroy();\n  res.send(\"User logged out\");\n});\n\n// Get the admin if he is authenticated\nrouter.get('/getUser', (req,res) => {\n  Models.Admin.findOne({ where: { id: req.user } }).then((admin) => {\n    res.json(admin.dataValues.pseudo);\n  });\n});\n\n\n// Routes relatives a la gestion des admins et des users\nrouter.post('/createAdmin', (req, res) => {\n  console.log(`creating admin ${req.body.pseudo}`);\n  // On vérifie que les données minmums pour créer un utilisateur sont bien présentes\n  if (!req.body.pseudo || !req.body.mp) {\n    console.log(\"/!\\\\ ERROR : The body of the create admin request doesnt contain pseudo or mp !\");\n    res.status(400).send(\"Bad Request : The body of the create admin request doesnt contain pseudo or mp ! \");\n  } else {\n    Models.Admin.addAdmin(req.body.pseudo, req.body.mp, Date.now()).then(() => {\n      console.log(`Added admin: ${req.body.pseudo}`);\n      res.status(200).send(`Admin ${req.body.pseudo} created`);\n    });\n  }\n});\n\nrouter.post('/csvPost',\n  (req, res) => {\n    const promises = [];\n    req.body.userList.forEach((user) => {\n      promises.push(Models.User.addUser(user.firstName, user.lastName, user.email));\n    });\n    Promise.all(promises).then(res.status(200).json(\"User list added\"));\n  });\n\nrouter.post('/singlePost',\n  (req, res) => {\n    Models.User.addUser(req.body.user.firstName, req.body.user.lastName, req.body.user.email).then(() => {\n      res.status(200).send(req.body.email);\n      console.log(\"New user added: \", req.body.user);\n    });\n  }); \n\n// Route relative à l'affichage et la creation de sondage\n\nrouter.get('/getSondage', (req, res) => {\n  Models.Admin.findOne({ where: { id: req.user } }).then((admin) => {\n    admin.getSondage().then((sondageList) => {\n      console.log(\"Sent all sondages to client\");\n      res.status(200).json(sondageList);\n    });\n  });\n});\n\n/* Survey object sent from the front to /postSondage\n  {\n    name: sondagename,\n    thematiqueList: [\n      {\n        name: thematiquename,\n        questionList: [\n          {\n            keyWord: motclef,\n            question: question,\n          },\n          { ... },\n        ]\n      },\n      { ... },\n    ]\n  }\n*/\nrouter.post('/postSondage', (req, res) => {\n  Models.Admin.findOne({ where: { id: req.user } }).then((admin) => {\n    admin.createSondage(req.body).then(() => {\n      console.log(\"New sondage created: \", req.body.name);\n      res.status(200).send(\"New sondage created\");\n    });\n  });\n});\n\nrouter.post('/changeNextSondage', (req, res) => {\n  if (!req.body) {\n    console.log(\"/!\\\\ ERROR : Inccorect body\");\n    res.status(400).send(\"Bad Request : The body doesnt contain next_sondage ! \");\n  } else {\n    Models.Sondage.update({ current: false }, { where: { current: true } }).then(() => {\n      Models.Sondage.update({ current: true }, { where: { id: req.body.id } }).then((sondage) => {\n        console.log(\"Changed the sondage to sondage: \", req.body.name);\n        res.status(200).json(sondage.dataValues);\n      });\n    });\n  }\n});\n\n// Route relative aux statisques\n\nrouter.get('/numberRemplissages', (req, res) => {\n  Data.getNumberRemplissages((count) => {\n    console.log(\"Fetching total number of Remplissage\");\n    res.status(200).json(count);\n  });\n});\n\nrouter.get('/numberRemplissagesJour/:jour', (req, res) => {\n  Data.getNumberRemplissagesJour(req.params.jour, (count) => {\n    console.log(\"Fetching total number of Remplissage on: \", req.params.jour);\n    res.status(200).json(count);\n  });\n});\n\nrouter.get('/getCommentaireJour/:jour', (req, res) => {\n  Data.getCommentairesJour(req.params.jour, (comments) => {\n    console.log(\"Fetching all Commentaires on: \", req.params.jour);\n    res.status(200).json(comments);\n  });\n});\n\nrouter.get('/numberReponses', (req, res) => {\n  Data.getNumberReponses((count) => {\n    console.log(\"Fetching total number of Reponse\");\n    res.status(200).json(count);\n  });\n});\n\nrouter.get('/numberReponsesJour/:jour', (req, res) => {\n  Data.getNumberReponsesJour(req.params.jour, (count) => {\n    res.status(200).json(count);\n    console.log(\"Fetching total number of Reponse on: \", req.params.jour);\n  });\n  res.json(\"ok\");\n});\n\nrouter.get(\"/generalStatistics\", (req, res) => {\n  Models.Admin.findById(req.user).then((admin) => {\n    admin.getStatistics((statisticTab) => {\n      res.json(statisticTab);\n    });\n  });\n});\n\nrouter.get(\"/specificStatistics/:year/:month/:day\", (req, res) => {\n  Models.Admin.findById(req.user).then((admin) => {\n    admin.getStatisticsSpecific(req.params).then((sondageResult) => {\n      res.json(sondageResult);\n    });\n  });\n});\n\nmodule.exports = router;"],"file":"admin.js"}