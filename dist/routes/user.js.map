{"version":3,"sources":["../../routes/user.js"],"names":["express","require","Models","userCheckToken","router","Router","get","req","res","user","sondage_id","remplissage_id","serverResponse","alreadyAnswered","Remplissage","findOne","where","id","then","remplissage","Question","findAll","questions","questionList","forEach","question","push","json","post","user_id","findById","send","msg","User","sondage","answered_questions","body","answerSondage","newIntensity","update","mailIntensity","module","exports"],"mappings":"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","sourcesContent":["const express = require('express');\nconst Models = require('../models/index');\nconst userCheckToken = require('../controllers/userCheckToken');\n\nconst router = express.Router();\n\n// front send un get avec header\nrouter.get('/getSondage',\n  userCheckToken,\n  (req, res) => {\n    const { sondage_id, remplissage_id } = req.user;\n    const serverResponse = { alreadyAnswered: false };\n    Models.Remplissage.findOne({ where: { id: remplissage_id } }).then((remplissage) => {\n      if (!remplissage) {\n        Models.Question.findAll({ where: { sondage_id: sondage_id } }).then((questions) => {\n          const questionList = [];\n          questions.forEach((question) => {\n            questionList.push(question);\n          });\n          serverResponse.questionList = questionList;\n          res.json(serverResponse);\n        });\n      } else {\n        serverResponse.alreadyAnswered = true;\n        res.json(serverResponse);\n      }\n    });\n  });\n\n// front send un post avec header et dans le body un answered_questions (cf index.js)\nrouter.post('/answerSondage',\n  userCheckToken,\n  (req, res) => {\n    const { user_id, sondage_id, remplissage_id } = req.user;\n    Models.Remplissage.findById(remplissage_id).then((remplissage) => {\n      if (remplissage) {\n        res.send({ msg: \"Vous aviez dejas repondue au sondage...\" });\n      } else {\n        Models.User.findById(user_id).then((user) => {\n          const sondage = { \n            sondage_id: sondage_id,\n            remplissage_id: remplissage_id,\n            answered_questions: req.body.answered_questions, \n          };\n          user.answerSondage(sondage);\n          res.send({ msg: \"merci d'avoir repondue :)\" });\n        });\n      }\n    });\n  });\n\nrouter.post('/changeFreq', userCheckToken, (req, res) => {\n  if (typeof (req.body.newIntensity) === \"number\") {\n    Models.User.update(\n      { mailIntensity: req.body.newIntensity },\n      { where: req.body.user_id },\n    ).then(res.send({ msg: \"Mail Intensity changed\" }));\n  }\n});\n\nmodule.exports = router;\n"],"file":"user.js"}