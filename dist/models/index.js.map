{"version":3,"sources":["../../models/index.js"],"names":["Sequelize","require","env","id_generator","userConstructor","adminConstructor","jourSondageConstructor","questionConstructor","remplissageConstructor","reponseConstructor","sondageConstructor","thematiqueConstructor","commentaireConstructor","Op","sequelize","database","username","password","host","dialect","operatorsAliases","logging","pool","max","min","acquire","idle","User","Admin","JourSondage","Question","Remplissage","Reponse","Sondage","Thematique","Commentaire","belongsTo","foreignKey","targetKey","prototype","getSondage","Promise","resolve","sondageList","findAll","then","sondages","include","model","questions","forEach","sondage","thematiqueList","question","dataValues","sondage_id","id","thema","filter","thematique","thematique_id","length","questionList","push","valeur","name","current","createSondage","promises","addSondage","pseudo","Date","now","findOrCreate","where","defaults","spread","created_or_found_thematique","created_value","console","log","addQuestion","text","keyWord","all","getStatistics","next","statistics","monthSentSondage","monthAnsweredSondage","totalSentSondage","totalAnsweredSondage","todayAnsweredSendedRate","todayAverageSatisfaction","weekAverageSatisfaction","getTotalAnsweredSondage","count","total","getTotalSentSondage","sum","getJourSentSondage","jour","jourDate","toLocaleDateString","findOne","date_emmission","jsondage","nombre_emission","getJourAnsweredSondage","date","nb","getMonthSentSondage","intPromises","i","data","getMonthAnsweredSondage","getTodayRate","rate","getDayStatis","reps","satisfaction","rep","getTodayStatis","getWeekStatis","statisticTab","findSondage","req","user","remplissage_id","serverResponse","alreadyAnswered","remplissage","Map","quest","JSON","parse","stringify","get","set","newList","elem","reponses","commentaires","sondageName","reponseList","commentaireList","reponse","commentaire","answerSondage","Promises","addRemplissage","answered_questions","addReponse","question_id","answer","answered_commentaires","addCommentaire","updateSondage","updateReponse","comment","updateCommentaire","Models","module","exports"],"mappings":"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","sourcesContent":["const Sequelize = require('sequelize');\nconst env = require('../const');\nconst id_generator = require('../custom_module/id_generator');\n\n// models constructors\nconst userConstructor = require('./constructor/user');\nconst adminConstructor = require('./constructor/admin');\nconst jourSondageConstructor = require('./constructor/jourSondage');\nconst questionConstructor = require('./constructor/question');\nconst remplissageConstructor = require('./constructor/remplissage');\nconst reponseConstructor = require('./constructor/reponse');\nconst sondageConstructor = require('./constructor/sondage');\nconst thematiqueConstructor = require('./constructor/thematique');\nconst commentaireConstructor = require('./constructor/commentaire');\n\nconst Op = Sequelize.Op;\n// sequelize connection\nconst sequelize = new Sequelize(env.database, env.username, env.password, {\n  host: env.host,\n  dialect: 'mysql',\n  operatorsAliases: false,\n  logging: false,\n  pool: {\n    max: 5,\n    min: 0,\n    acquire: 30000,\n    idle: 10000,\n  },\n});\n\n// Models\nconst User = userConstructor(sequelize);\nconst Admin = adminConstructor(sequelize);\nconst JourSondage = jourSondageConstructor(sequelize);\nconst Question = questionConstructor(sequelize);\nconst Remplissage = remplissageConstructor(sequelize);\nconst Reponse = reponseConstructor(sequelize);\nconst Sondage = sondageConstructor(sequelize);\nconst Thematique = thematiqueConstructor(sequelize);\nconst Commentaire = commentaireConstructor(sequelize);\n\n// // Foreign keys\nQuestion.belongsTo(Sondage, { foreignKey: 'sondage_id', targetKey: 'id' });\nJourSondage.belongsTo(Sondage, { foreignKey: 'sondage_id', targetKey: 'id' });\nReponse.belongsTo(Question, { foreignKey: 'question_id', targetKey: 'id' });\nReponse.belongsTo(Remplissage, { foreignKey: 'remplissage_id', targetKey: 'id' });\nRemplissage.belongsTo(Sondage, { foreignKey: 'sondage_id', targetKey: 'id' });\nRemplissage.belongsTo(User, { foreignKey: 'user_id', targetKey: 'id' });\nQuestion.belongsTo(Thematique, { foreignKey: 'thematique_id', targetKey: 'id' });\nCommentaire.belongsTo(Thematique, { foreignKey: 'thematique_id', targetKey: 'id' });\nCommentaire.belongsTo(Remplissage, { foreignKey: 'remplissage_id', targetKey: 'id' });\n\n// Should change this function by using promises more\nAdmin.prototype.getSondage = function () {\n  return new Promise((resolve) => {\n    const sondageList = [];\n    Sondage.findAll().then((sondages) => {\n      Question.findAll({\n        include: [{\n          model: Thematique,\n        }],\n      }).then((questions) => {\n        sondages.forEach((sondage) => {\n          const thematiqueList = [];\n          questions.forEach((question) => {\n            if (question.dataValues.sondage_id === sondage.dataValues.id) {\n              const thema = thematiqueList.filter(\n                thematique => thematique.id === question.dataValues.thematique_id,\n              );\n              if (thema.length > 0) {\n                thema[0].questionList.push({\n                  id: question.dataValues.id, \n                  question: question.dataValues.valeur,\n                });\n              } else {\n                thematiqueList.push({\n                  id: question.dataValues.thematique_id,\n                  name: question.dataValues.thematique.dataValues.name,\n                  questionList: [{\n                    id: question.dataValues.id, \n                    question: question.dataValues.valeur,\n                  }],\n                });\n              }\n            }\n          });\n          sondageList.push({\n            id: sondage.dataValues.id, \n            name: sondage.dataValues.name,\n            thematiqueList: thematiqueList,\n            current: sondage.dataValues.current,\n          });\n        });\n        resolve(sondageList);\n      });\n    });\n  });\n};\n\nAdmin.prototype.createSondage = function (sondage) {\n  return new Promise((resolve) => {\n    const sondage_id = id_generator();\n    const promises = [];\n    promises.push(Sondage.addSondage(sondage_id, this.pseudo, Date.now(), sondage.name));\n    sondage.thematiqueList.forEach((thematique) => {\n      Thematique.findOrCreate(\n        { \n          where: { name: thematique.name },\n          defaults: { name: thematique.name, id: id_generator() },\n        },\n      ).spread(\n        (created_or_found_thematique, created_value) => {\n          if (created_value) {\n            console.log(\"nouvelle thematique\");\n          }\n          thematique.questionList.forEach((question) => {\n            promises.push(Question.addQuestion(\n              sondage_id, created_or_found_thematique.id,\n              question.text,\n              question.keyWord,\n            ));\n          });\n        },\n      );\n    });\n    Promise.all(promises).then(resolve);\n  });\n};\n\nAdmin.prototype.getStatistics = function (next) {\n  const statistics = {\n    monthSentSondage: [], // fait\n    monthAnsweredSondage: [], // fait\n    totalSentSondage: 0, // fait\n    totalAnsweredSondage: 0, // fait\n    todayAnsweredSendedRate: 0, // fait\n    todayAverageSatisfaction: 0, // fait\n    weekAverageSatisfaction: [],\n  };\n  \n  const getTotalAnsweredSondage = new Promise(function (resolve) {\n    Remplissage.count().then((total) => {\n      resolve(total);\n    });\n  });\n\n  const getTotalSentSondage = new Promise(function (resolve) {\n    JourSondage.sum('nombre_emission').then((total) => {\n      resolve(total);\n    });\n  });\n\n  const getJourSentSondage = jour => new Promise((resolve) => {\n    const jourDate = new Date(jour).toLocaleDateString();\n    JourSondage.findOne({ where: { date_emmission: jour } }).then((jsondage) => {\n      if (jsondage) {\n        console.log(\"On \", jourDate, \", \", jsondage.dataValues.nombre_emission, \" mails were sent.\");\n        resolve(jsondage.dataValues.nombre_emission);\n      } else {\n        console.log(\"No mail sent on: \", jourDate);\n        resolve(0);\n      }\n    });\n  });\n\n  const getJourAnsweredSondage = jour => new Promise((resolve) => {\n    const jourDate = new Date(jour).toLocaleDateString();\n    Remplissage.count({ where: { date: jour } }).then((nb) => {\n      console.log(\"On \", jourDate, \", \", nb, \" sondage were answered.\");\n      resolve(nb);\n    });\n  });\n\n  const getMonthSentSondage = new Promise((resolve) => {\n    const intPromises = [];\n    for (let i = 0; i < 31; i++) {\n      intPromises.push(getJourSentSondage(Date.now() - (86400000 * i)));\n    }\n    Promise.all(intPromises).then((data) => {\n      resolve(data);\n    });\n  });\n\n  const getMonthAnsweredSondage = new Promise((resolve) => {\n    const intPromises = [];\n    for (let i = 0; i < 31; i++) {\n      intPromises.push(getJourAnsweredSondage(Date.now() - (86400000 * i)));\n    }\n    Promise.all(intPromises).then((data) => {\n      resolve(data);\n    });\n  });\n\n  const getTodayRate = new Promise((resolve) => {\n    Promise.all([getJourAnsweredSondage(Date.now()), getJourSentSondage(Date.now())])\n      .then(((data) => {\n        console.log(data);\n        const rate = data[0] / data[1];\n        resolve(rate);\n      }));\n  });\n\n  const getDayStatis = jour => new Promise((resolve) => {\n    Reponse.findAll({\n      include: [{\n        model: Remplissage,\n        where: { date: jour },\n      }],\n    }).then((reps) => {\n      if (reps.length > 0) {\n        let satisfaction = 0;\n        reps.forEach((rep) => {\n          satisfaction += rep.dataValues.valeur;\n        });\n        resolve(satisfaction / reps.length);\n      } else {\n        resolve(0);\n      }\n    });\n  });\n\n  const getTodayStatis = new Promise((resolve) => {\n    getDayStatis(Date.now()).then(data => resolve(data));\n  });\n\n  const getWeekStatis = new Promise((resolve) => {\n    const intPromises = [];\n    for (let i = 0; i < 8; i++) {\n      intPromises.push(getDayStatis(Date.now() - (86400000 * i)));\n    }\n    Promise.all(intPromises).then((data) => {\n      resolve(data);\n    });\n  });\n\n  Promise.all([\n    getTotalAnsweredSondage,\n    getTotalSentSondage,\n    getMonthSentSondage,\n    getMonthAnsweredSondage,\n    getTodayRate,\n    getTodayStatis,\n    getWeekStatis,\n  ]).then((statisticTab) => {\n    const [\n      totalAnsweredSondage, \n      totalSentSondage, \n      monthSentSondage, \n      monthAnsweredSondage,\n      todayAnsweredSendedRate,\n      todayAverageSatisfaction,\n      weekAverageSatisfaction] = statisticTab;\n    next({\n      totalSentSondage: totalSentSondage,\n      totalAnsweredSondage: totalAnsweredSondage,\n      monthSentSondage: monthSentSondage,\n      monthAnsweredSondage: monthAnsweredSondage,\n      todayAnsweredSendedRate: todayAnsweredSendedRate,\n      todayAverageSatisfaction: todayAverageSatisfaction,\n      weekAverageSatisfaction: weekAverageSatisfaction,\n    });\n  });\n};\n\nUser.prototype.findSondage = function (req) {\n  return new Promise((resolve) => {\n    const { sondage_id, remplissage_id } = req.user;\n    const serverResponse = { alreadyAnswered: false };\n    Remplissage.findOne({ where: { id: remplissage_id } }).then((remplissage) => {\n      Question.findAll({\n        include: [{\n          model: Thematique,\n        }],\n        where: { sondage_id: sondage_id }, \n      }).then((questions) => {\n        const questionList = [];\n        const thematiqueList = new Map();\n        questions.forEach((question) => {\n          const quest = JSON.parse(JSON.stringify(question));\n          delete quest.thematique;\n          if (!thematiqueList.get(question.dataValues.thematique.dataValues.id)) {\n            thematiqueList.set(\n              question.dataValues.thematique.dataValues.id, \n              question.dataValues.thematique.dataValues,\n            );\n          }\n          const newList = thematiqueList.get(question.dataValues.thematique.dataValues.id);\n          if (newList.questionList) {\n            newList.questionList.push(quest);\n          } else {\n            newList.questionList = [quest];\n          }\n          thematiqueList.set(question.dataValues.thematique.dataValues.id, newList); \n        });\n        thematiqueList.forEach((elem) => {\n          questionList.push(elem);\n        });\n        serverResponse.thematiqueList = questionList; \n\n        // Si le sondage a déjà été remplis, on renvois les réponses\n        if (remplissage) {\n          serverResponse.alreadyAnswered = true;\n          Reponse.findAll({ where: { remplissage_id: remplissage_id } }).then((reponses) => {\n            Sondage.findOne({ where: { id: sondage_id } }).then((sondage) => {\n              Commentaire.findAll({ where: { remplissage_id: remplissage_id } })\n                .then((commentaires) => {\n                  serverResponse.sondageName = sondage.dataValues.name;\n                  const reponseList = [];\n                  const commentaireList = [];\n                  reponses.forEach((reponse) => {\n                    reponseList.push(reponse);\n                  });\n                  commentaires.forEach((commentaire) => {\n                    commentaireList.push(commentaire);\n                  }); \n                  serverResponse.reponseList = reponseList;\n                  serverResponse.commentaireList = commentaireList;\n                  resolve(serverResponse);\n                });\n            });\n          }); \n        } else {\n          Sondage.findOne({ where: { id: sondage_id } }).then((sondage) => {\n            serverResponse.sondageName = sondage.dataValues.name;\n            resolve(serverResponse);\n          }); \n        }\n      }); \n    });\n  });\n};\n    \n// input\n// const sondage = {\n//   remlissage_id: \"...\"\n//   sondage_id: \"..\",\n//   answered_questions: [\n//     {\n//       question_id: \"...\",\n//       answer: \"...\",\n//     },\n//   answered_commentaires: [\n//     {\n//      thematique_id: \"...\",\n//      answer: \"...\",\n//     },\n//   ],\n// };\n// uniquement les questions auxquelles l'ut a repondue, pas de question sans reponses\nUser.prototype.answerSondage = function (sondage) {\n  return new Promise((resolve) => {\n    const remplissage_id = sondage.remplissage_id;\n    const Promises = [];\n    Promises.push(\n      Remplissage.addRemplissage(remplissage_id, sondage.sondage_id, this.id, Date.now()),\n    );\n    sondage.answered_questions.forEach((question) => {\n      Promises.push(Reponse.addReponse(remplissage_id, question.question_id, question.answer));\n    });\n    sondage.answered_commentaires.forEach((commentaire) => {\n      Promises.push(\n        Commentaire.addCommentaire(remplissage_id, commentaire.thematique_id, commentaire.answer),\n      );\n    });\n    Promise.all(Promises).then(resolve);\n  });\n};\n\nUser.prototype.updateSondage = function (sondage) {\n  return new Promise((resolve) => {\n    const remplissage_id = sondage.remplissage_id;\n    sondage.answered_questions.forEach((question) => {\n      Reponse.findOne({\n        where: { \n          remplissage_id: remplissage_id, \n          question_id: question.question_id,\n        }, \n      })\n        .then((reponse) => {\n          Reponse.updateReponse(reponse.dataValues.id, question.answer);\n        });\n    });\n    sondage.answered_commentaires.forEach((commentaire) => {\n      Commentaire.findOne({\n        where: {\n          remplissage_id: remplissage_id, \n          thematique_id: commentaire.thematique_id,\n        }, \n      })\n        .then((comment) => {\n          Commentaire.updateCommentaire(comment.dataValues.id, commentaire.answer);\n        });\n    });\n    resolve();\n  });\n};\n\nconst Models = {\n  User: User,\n  Admin: Admin,\n  Sondage: Sondage,\n  JourSondage: JourSondage,\n  Remplissage: Remplissage,\n  Question: Question,\n  Reponse: Reponse,\n  Thematique: Thematique,\n  Commentaire: Commentaire,\n};\n\nmodule.exports = Models;"],"file":"index.js"}