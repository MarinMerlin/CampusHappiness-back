{"version":3,"sources":["../../../models/constructor/admin.js"],"names":["Sequelize","require","crypto","jwt","id_generator","env","adminConstructor","sequelize","Admin","define","id","allowNull","type","STRING","primaryKey","pseudo","salt","hash","addAdmin","password","next","randomBytes","toString","sync","then","create","pbkdf2Sync","prototype","validPassword","generateJwt","expiry","Date","setDate","getDate","sign","exp","parseInt","getTime","admin_token_secret_key","module","exports"],"mappings":";;AAAA,IAAMA,SAAS,GAAGC,OAAO,CAAC,WAAD,CAAzB;;AACA,IAAMC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAAtB;;AACA,IAAME,GAAG,GAAGF,OAAO,CAAC,cAAD,CAAnB;;AACA,IAAMG,YAAY,GAAGH,OAAO,CAAC,kCAAD,CAA5B;;AACA,IAAMI,GAAG,GAAGJ,OAAO,CAAC,aAAD,CAAnB;;AAEA,IAAMK,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAUC,SAAV,EAAqB;AAC5C,MAAMC,KAAK,GAAGD,SAAS,CAACE,MAAV,CAAiB,OAAjB,EAA0B;AACtCC,IAAAA,EAAE,EAAE;AACFC,MAAAA,SAAS,EAAE,KADT;AAEFC,MAAAA,IAAI,EAAEZ,SAAS,CAACa,MAFd;AAGFC,MAAAA,UAAU,EAAE;AAHV,KADkC;AAMtCC,IAAAA,MAAM,EAAE;AACNJ,MAAAA,SAAS,EAAE,KADL;AAENC,MAAAA,IAAI,EAAEZ,SAAS,CAACa;AAFV,KAN8B;AAUtCG,IAAAA,IAAI,EAAE;AACJJ,MAAAA,IAAI,EAAEZ,SAAS,CAACa;AADZ,KAVgC;AAatCI,IAAAA,IAAI,EAAE;AACJL,MAAAA,IAAI,EAAEZ,SAAS,CAACa;AADZ;AAbgC,GAA1B,CAAd;;AAiBAL,EAAAA,KAAK,CAACU,QAAN,GAAiB,UAAUH,MAAV,EAAkBI,QAAlB,EAA4BC,IAA5B,EAAkC;AACjD,QAAMJ,IAAI,GAAGd,MAAM,CAACmB,WAAP,CAAmB,EAAnB,EAAuBC,QAAvB,CAAgC,KAAhC,CAAb;AACAd,IAAAA,KAAK,CAACe,IAAN,GAAaC,IAAb,CAAkB,YAAM;AACtBhB,MAAAA,KAAK,CAACiB,MAAN,CAAa;AACXf,QAAAA,EAAE,EAAEN,YAAY,EADL;AAEXW,QAAAA,MAAM,EAANA,MAFW;AAGXC,QAAAA,IAAI,EAAJA,IAHW;AAIXC,QAAAA,IAAI,EAAEf,MAAM,CAACwB,UAAP,CAAkBP,QAAlB,EAA4BH,IAA5B,EAAkC,IAAlC,EAAwC,EAAxC,EAA4C,QAA5C,EAAsDM,QAAtD,CAA+D,KAA/D;AAJK,OAAb;AAMD,KAPD;AAQAF,IAAAA,IAAI;AACL,GAXD,CAlB4C,CA+B5C;;;AACAZ,EAAAA,KAAK,CAACmB,SAAN,CAAgBC,aAAhB,GAAgC,UAAUT,QAAV,EAAoB;AAClD,QAAMF,IAAI,GAAGf,MAAM,CAACwB,UAAP,CAAkBP,QAAlB,EAA4B,KAAKH,IAAjC,EAAuC,IAAvC,EAA6C,EAA7C,EAAiD,QAAjD,EAA2DM,QAA3D,CAAoE,KAApE,CAAb;AACA,WAAO,KAAKL,IAAL,KAAcA,IAArB;AACD,GAHD;;AAIAT,EAAAA,KAAK,CAACmB,SAAN,CAAgBE,WAAhB,GAA8B,YAAY;AACxC,QAAMC,MAAM,GAAG,IAAIC,IAAJ,EAAf;AACAD,IAAAA,MAAM,CAACE,OAAP,CAAeF,MAAM,CAACG,OAAP,KAAmB,CAAlC;AACA,WAAO9B,GAAG,CAAC+B,IAAJ,CAAS;AACdxB,MAAAA,EAAE,EAAE,KAAKA,EADK;AAEdK,MAAAA,MAAM,EAAE,KAAKA,MAFC;AAGdoB,MAAAA,GAAG,EAAEC,QAAQ,CAACN,MAAM,CAACO,OAAP,KAAmB,IAApB,EAA0B,EAA1B;AAHC,KAAT,EAIJhC,GAAG,CAACiC,sBAJA,CAAP;AAKD,GARD;;AAUA,SAAO9B,KAAP;AACD,CA/CD;;AAkDA+B,MAAM,CAACC,OAAP,GAAiBlC,gBAAjB","sourcesContent":["const Sequelize = require('sequelize');\nconst crypto = require('crypto');\nconst jwt = require('jsonwebtoken');\nconst id_generator = require('../../custom_module/id_generator');\nconst env = require(\"../../const\");\n\nconst adminConstructor = function (sequelize) {\n  const Admin = sequelize.define('admin', {\n    id: {\n      allowNull: false,\n      type: Sequelize.STRING,\n      primaryKey: true,\n    },\n    pseudo: {\n      allowNull: false,\n      type: Sequelize.STRING,\n    },\n    salt: {\n      type: Sequelize.STRING,\n    },\n    hash: {\n      type: Sequelize.STRING,\n    },\n  });\n  Admin.addAdmin = function (pseudo, password, next) {\n    const salt = crypto.randomBytes(16).toString('hex');\n    Admin.sync().then(() => {\n      Admin.create({\n        id: id_generator(),\n        pseudo,\n        salt,\n        hash: crypto.pbkdf2Sync(password, salt, 1000, 64, 'sha512').toString('hex'),\n      });\n    });\n    next();\n  };\n\n  // instance methods\n  Admin.prototype.validPassword = function (password) {\n    const hash = crypto.pbkdf2Sync(password, this.salt, 1000, 64, 'sha512').toString('hex');\n    return this.hash === hash;\n  };\n  Admin.prototype.generateJwt = function () {\n    const expiry = new Date();\n    expiry.setDate(expiry.getDate() + 7);\n    return jwt.sign({\n      id: this.id,\n      pseudo: this.pseudo,\n      exp: parseInt(expiry.getTime() / 1000, 10),\n    }, env.admin_token_secret_key);\n  };\n\n  return Admin;\n};\n\n\nmodule.exports = adminConstructor;\n"],"file":"admin.js"}